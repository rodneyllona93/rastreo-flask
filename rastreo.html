<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Rastreo Vehicular</title>
</head>
<body>
  <h2>Rastreo en tiempo real</h2>
  <p id="estado">Esperando ubicaciÃ³n...</p>

  <script>
    const nombre = prompt("Ingrese su nombre o ID del vehÃ­culo:");

    function enviarUbicacion(lat, lng) {
      fetch("/actualizar_ubicacion", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nombre, lat, lng })
      })
      .then(res => res.json())
      .then(data => console.log("âœ… UbicaciÃ³n enviada:", data))
      .catch(err => console.error("âŒ Error al enviar:", err));
    }

    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(pos => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;
        document.getElementById("estado").innerText = `UbicaciÃ³n actual: ${lat}, ${lng}`;
        enviarUbicacion(lat, lng);
      }, err => {
  let msg = "âš ï¸ Error al obtener la ubicaciÃ³n.";
  if (err.code === 1) msg = "ğŸš« Permiso de ubicaciÃ³n denegado.";
  if (err.code === 2) msg = "ğŸ“¶ No se pudo determinar la posiciÃ³n (sin seÃ±al GPS o red).";
  if (err.code === 3) msg = "â° Tiempo de espera agotado.";
  document.getElementById("estado").innerText = msg;
  console.error("Detalles del error:", err);

      }, { enableHighAccuracy: true, maximumAge: 5000, timeout: 10000 });
    } else {
      document.getElementById("estado").innerText = "Tu navegador no soporta geolocalizaciÃ³n.";
    }
  </script>
</body>
</html>
